<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase Auth Test - RBS</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .test-container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-result {
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid;
      }
      .success {
        background: #d4edda;
        border-color: #28a745;
        color: #155724;
      }
      .error {
        background: #f8d7da;
        border-color: #dc3545;
        color: #721c24;
      }
      .info {
        background: #d1ecf1;
        border-color: #17a2b8;
        color: #0c5460;
      }
      .btn {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .btn:hover {
        background: #0056b3;
      }
      .code {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="index.html">
        <div class="logo">
          <img
            id="logo"
            src="./Images/RBS Logo main.svg"
            alt="RBS Logo. It's a box that's red"
          />
        </div>
      </a>
      <div class="burger">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
      </div>

      <div id="webNav">
        <div id="navBtnsCont" class="nav-links">
          <a href="index.html"><li>Home</li></a>
          <a href="projects.html"><li>Projects</li></a>
          <a href="products.html"><li>Products</li></a>
          <a href="services.html"><li>Services</li></a>
          <a href="articles.html"><li>Articles</li></a>
          <a href="about.html"><li>About</li></a>
          <a href="contact.html"><li>Contact</li></a>
          <div class="tools-dropdown">
            <li>More ‚ñº</li>
            <div class="tools-dropdown-content">
              <a href="clip_path_editor.html">Clip Path Editor</a>
              <a href="cubic_bezier.html">Cubic Bezier</a>
              <a href="base64.html">Base64 image encoder - decoder</a>
              <a href="kanban.html">Kanban Task Manager</a>
              <a href="qr_code_generator.html">QR code generator</a>
              <a href="custom-document-signing.html">Document Signing</a>
            </div>
          </div>

          <a href="admin.html" style="display: none"><li>Admin</li></a>
          <li>
            <button
              onclick="handleSignOut()"
              class="sign-out-btn"
              style="display: none"
            >
              Sign Out
            </button>
          </li>

          <br />
          <br />
          <br />
        </div>
      </div>
      <div class="dropdown-content">
        <div id="navBtnsCont" class="nav-links">
          <a href="index.html"><li>Home</li></a>
          <a href="projects.html"><li>Projects</li></a>
          <a href="products.html"><li>Products</li></a>
          <a href="services.html"><li>Services</li></a>
          <a href="articles.html"><li>Articles</li></a>
          <a href="about.html"><li>About</li></a>
          <a href="contact.html"><li>Contact</li></a>
          <div class="tools-dropdown">
            <li>More ‚ñº</li>
            <div class="tools-dropdown-content">
              <a href="clip_path_editor.html">Clip Path Editor</a>
              <a href="cubic_bezier.html">Cubic Bezier</a>
              <a href="base64.html">Base64 image encoder - decoder</a>
              <a href="kanban.html">Kanban Task Manager</a>
              <a href="qr_code_generator.html">QR code generator</a>
              <a href="custom-document-signing.html">Document Signing</a>
            </div>
          </div>

          <a href="admin.html" style="display: none"><li>Admin</li></a>
          <li>
            <button
              onclick="handleSignOut()"
              class="sign-out-btn"
              style="display: none"
            >
              Sign Out
            </button>
          </li>
        </div>
      </div>
      <div id="shadow"></div>
    </nav>

    <div class="test-container">
      <h1>üîß Firebase Authentication Test</h1>
      <p>
        This page helps diagnose Firebase Authentication issues in your local
        environment.
      </p>

      <div id="results"></div>

      <button onclick="runTests()" class="btn">Run Authentication Tests</button>
      <button onclick="testEmailAuth()" class="btn">
        Test Email/Password Auth
      </button>
      <button onclick="testGoogleAuth()" class="btn">Test Google Auth</button>

      <div style="margin-top: 30px">
        <h3>üìã Manual Checklist</h3>
        <ol>
          <li>
            Check that localhost is in Firebase Console ‚Üí Authentication ‚Üí
            Settings ‚Üí Authorized domains
          </li>
          <li>Verify your API key in firebase-config.js is correct</li>
          <li>Ensure you're accessing via http://localhost (not file://)</li>
          <li>Check browser console for detailed error messages</li>
        </ol>
      </div>
    </div>

    <!-- Firebase Configuration -->
    <script src="config/firebase-config.js"></script>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        GoogleAuthProvider,
        signInWithPopup,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";

      let app, auth, googleProvider;
      let results = [];

      function addResult(message, type = "info") {
        results.push({ message, type });
        updateResults();
      }

      function updateResults() {
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = results
          .map((r) => `<div class="test-result ${r.type}">${r.message}</div>`)
          .join("");
      }

      window.runTests = async function () {
        results = [];
        addResult("üîç Starting Firebase Authentication Tests...", "info");

        // Test 1: Configuration
        if (!window.firebaseConfig) {
          addResult("‚ùå Firebase configuration not loaded!", "error");
          return;
        }
        addResult("‚úÖ Firebase configuration loaded", "success");
        addResult(`Project ID: ${window.firebaseConfig.projectId}`, "info");
        addResult(`Auth Domain: ${window.firebaseConfig.authDomain}`, "info");

        // Test 2: Initialize Firebase
        try {
          app = initializeApp(window.firebaseConfig);
          auth = getAuth(app);
          googleProvider = new GoogleAuthProvider();
          addResult("‚úÖ Firebase app initialized successfully", "success");
        } catch (error) {
          addResult(
            `‚ùå Firebase initialization failed: ${error.message}`,
            "error"
          );
          return;
        }

        // Test 3: Check current domain
        const currentDomain = window.location.hostname;
        const currentPort = window.location.port;
        const fullDomain = currentPort
          ? `${currentDomain}:${currentPort}`
          : currentDomain;
        addResult(`üåê Current domain: ${fullDomain}`, "info");

        // Test 4: Auth state listener
        onAuthStateChanged(auth, (user) => {
          if (user) {
            addResult(`‚úÖ User authenticated: ${user.email}`, "success");
          } else {
            addResult("‚ÑπÔ∏è No user currently authenticated", "info");
          }
        });

        addResult("‚úÖ All basic tests completed", "success");
      };

      window.testEmailAuth = async function () {
        if (!auth) {
          addResult(
            "‚ùå Firebase not initialized. Run basic tests first.",
            "error"
          );
          return;
        }

        const email = prompt("Enter test email:");
        const password = prompt("Enter password:");

        if (!email || !password) {
          addResult("‚ùå Email and password required for test", "error");
          return;
        }

        try {
          addResult("üîÑ Testing email/password authentication...", "info");
          const userCredential = await signInWithEmailAndPassword(
            auth,
            email,
            password
          );
          addResult(
            `‚úÖ Email/password authentication successful: ${userCredential.user.email}`,
            "success"
          );
        } catch (error) {
          addResult(
            `‚ùå Email/password authentication failed: ${error.code} - ${error.message}`,
            "error"
          );
        }
      };

      window.testGoogleAuth = async function () {
        if (!auth || !googleProvider) {
          addResult(
            "‚ùå Firebase not initialized. Run basic tests first.",
            "error"
          );
          return;
        }

        try {
          addResult("üîÑ Testing Google authentication...", "info");
          const result = await signInWithPopup(auth, googleProvider);
          addResult(
            `‚úÖ Google authentication successful: ${result.user.email}`,
            "success"
          );
        } catch (error) {
          addResult(
            `‚ùå Google authentication failed: ${error.code} - ${error.message}`,
            "error"
          );

          if (error.code === "auth/unauthorized-domain") {
            addResult(
              `üí° Fix: Add "${window.location.hostname}" to Firebase Console ‚Üí Authentication ‚Üí Settings ‚Üí Authorized domains`,
              "info"
            );
          }
        }
      };

      // Auto-run basic tests on load
      window.addEventListener("load", () => {
        setTimeout(runTests, 500);
      });
    </script>
  </body>
</html>
